version: '3'

services:
  postgres:
    image: registry.gitlab.com/ecohealthalliance/repel-infrastructure/repel-postgres
    build:
      context: './postgres'
      cache_from: registry.gitlab.com/ecohealthalliance/repel-infrastructure/repel-postgres
    volumes:
       - ./postgres/init:/docker-entrypoint-initdb.d
       - ./postgres/pgconf:/pgconf
       - ./backups:/backups
    command: postgres -c config_file=/pgconf/postgresql.conf
    ports:
      - '${POSTGRES_EXTERNAL_PORT}:5432'
    env_file: .env
    restart: on-failure
  cron:
    image: registry.gitlab.com/ecohealthalliance/repel-infrastructure/repel-cron
    build:
      context: './cron'
      cache_from: registry.gitlab.com/ecohealthalliance/repel-infrastructure/repel-cron
    links:
    - postgres:postgres
    env_file: .env
    restart: on-failure
    depends_on:
      - postgres
  scraper:
    image: registry.gitlab.com/ecohealthalliance/repel-infrastructure/repel-scraper
    build:
      context: './scraper'
      cache_from: registry.gitlab.com/ecohealthalliance/repel-infrastructure/repel-scraper
    links:
    - postgres:postgres
    env_file: .env
    restart: on-failure
    depends_on:
      - postgres

